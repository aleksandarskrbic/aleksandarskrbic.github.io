<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.9.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>The Power of Akka Streams - Aleksandar Skrbic</title>
<meta name="description" content="Scala, Akka, JVM, Akka Streams">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Aleksandar Skrbic">
<meta property="og:title" content="The Power of Akka Streams">
<meta property="og:url" content="http://localhost:4000/power-of-akka-streams/">


  <meta property="og:description" content="Scala, Akka, JVM, Akka Streams">



  <meta property="og:image" content="http://localhost:4000/images/akka/akka-streams-h.jpg">





  <meta property="article:published_time" content="2020-04-25T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/power-of-akka-streams/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Aleksandar Skrbic",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Aleksandar Skrbic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">Aleksandar Skrbic</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/search/" >Search Articles</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about/" >About</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/images/akka/akka-streams-h.jpg" alt="The Power of Akka Streams" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Aleksandar Skrbic</h3>
    
    
      <p class="author__bio" itemprop="description">
        Blogging mostly about distributed systems, databases and big data.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Novi Sad, Serbia</span>
        </li>
      

      

      
        <li>
          <a href="mailto:skrbic.alexa@gmail.com">
            <meta itemprop="email" content="skrbic.alexa@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/skrbic_a" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/aleksandar-skrbic" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/aleksandarskrbic" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="The Power of Akka Streams">
    <meta itemprop="description" content="Scala, Akka, JVM, Akka Streams">
    <meta itemprop="datePublished" content="April 25, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">The Power of Akka Streams
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  14 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        
<p>In the <a href="/akka-actors-1/">first</a> and the <a href="/akka-actors-2/">second</a> part of the <em>Data processing with Akka Actors</em> series, I introduced how to design actors based application. The example that I presented is a  way to simple and using actors to solve that is obliviously an overkill, but I think it’s a representative enough to show everything that is necessary to get started with building actors based applications.</p>

<p>Actors are the core of <a href="https://akka.io/">Akka toolkit</a> and they can’t be replaced, but every module in Akka toolkit is backed by actors. The purpose of these modules is to help engineers to abstract over low-level actor based code and focus on business logic. The result of using these modules is boilerplate free code, which is also less error-prone. In this article, the same example will be used to show how <a href="https://doc.akka.io/docs/akka/current/typed/index.html?_ga=2.208848017.2007999245.1587396807-1520704188.1583745843">Akka Actors</a> can be replaced with a few lines of <a href="https://doc.akka.io/docs/akka/current/stream/index.html">Akka Streams</a> code. Check <a href="https://akka.io/docs/">all modules</a> provided by Akka.</p>

<p>The tasks like moving and transferring data can be implemented with actors, but it demands a lot of code, to implement necessary mechanisms for stream processing workloads like back-pressure, buffering, and transforming data or error-recovery. So, for designing stream processing topologies with built-in back-pressure, Akka Streams should be considered.</p>

<h2 id="basic-terminology">Basic terminology</h2>

<ul>
  <li><strong>Source</strong> is a component that emits elements asynchronously downstream. It’s a starting point of every streaming topology any only has output.</li>
</ul>

<p>A source can be created from any Scala collection, it can be a Kafka topic, it can be created from constantly polling some HTTP endpoint, etc. Here’s a simple source created from Scala List that contains hashtags.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">source</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"#Scala"</span><span class="o">,</span> <span class="s">"#akka"</span><span class="o">,</span> <span class="s">"#JVM"</span><span class="o">,</span> <span class="s">"#Kafka"</span><span class="o">))</span>
</code></pre></div></div>

<ul>
  <li><strong>Sink</strong> is a component that receives elements, and as the opposite of the <strong>Source</strong>, it’s usually the final stage of in a stream processing topology. It only has input.</li>
</ul>

<p>A sink can be a Scala collection, Kafka Topic, or even an Akka Actor. Here is a list of all possible <a href="https://doc.akka.io/docs/akka/current/stream/operators/index.html#sink-operators">sinks</a>. Example of creating a simple sink, which will just print every element it receives.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">sink</span> <span class="k">=</span> <span class="nv">Sink</span><span class="o">.</span><span class="py">foreach</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="n">element</span><span class="o">))</span>
</code></pre></div></div>

<p>Note that the type parameter of the receiving element must be provided.</p>

<ul>
  <li><strong>Flow</strong> is a component that has both, input and output. It’s basically component that receives the data, transforms it, and passes it downstream to the sink or to the next flow in topology. Example of a few flows:</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">removeHash</span>  <span class="k">=</span> <span class="nc">Flow</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">map</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">toLowerCase</span> <span class="k">=</span> <span class="nc">Flow</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">map</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">toLowerCase</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">filter</span>      <span class="k">=</span> <span class="nc">Flow</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">filter</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span>
</code></pre></div></div>
<p>Same as creating a sink, we must provide a type parameter for the input element of the flow. These flows are pretty simple and self-explanatory. The first flow removes the hash from the input element, the second transforms string to lowercase and the third filter strings based on their length.</p>

<p>So you must be asking now, how to connect all these separate components to create stream processing topology. Pipelining all components we defined earlier, we will create a graph, or how Akka it calls <strong>RunnableGraph</strong>. We know that source is a starting point, the sink is the last, and flows are somewhere in the middle. Our graph represents just a description of topology, it’s completely lazy.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">graph</span> <span class="k">=</span> <span class="nv">source</span><span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">removeHash</span><span class="o">).</span><span class="py">via</span><span class="o">(</span><span class="n">toLowerCase</span><span class="o">).</span><span class="py">via</span><span class="o">(</span><span class="n">filter</span><span class="o">).</span><span class="py">to</span><span class="o">(</span><span class="n">sink</span><span class="o">)</span>
</code></pre></div></div>
<p>Data will start to flow through it only after we run the graph. Running a graph will allocate the needed resources to execute topology, like actors, threads, etc.</p>

<p>Running a graph is as simple as invoking a <em>run</em> method on it.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">graph</span><span class="o">.</span><span class="py">run</span><span class="o">()</span>
</code></pre></div></div>

<p>If you try to execute code we write so far, it’s not gonna be possible. We need to create <em>ActorMaterializer</em> since the run method implicitly accepts it to execute a stream. Upon creation <em>ActorMaterializer</em> requires an <em>ActorSystem</em>. So every Akka Stream application starts with these two lines:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">val</span> <span class="nv">system</span>       <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"actor-system"</span><span class="o">)</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="nv">materialzier</span> <span class="k">=</span> <span class="nc">ActorMaterializer</span><span class="o">()</span>
</code></pre></div></div>

<p>Since Akka 2.6 version there is no need for <em>ActorMaterilzer</em> because a default materializer is now provided out of the box if implicit <em>ActorSystem</em> is available.</p>

<p>Akka Streams API provides us a builder pattern syntax to chain source, flow, and sink components in order to create a graph. IMHO it’s better to use it than creating separate components and then connecting them. Our stream processing app can be rewritten to look like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Main</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"actor-system"</span><span class="o">)</span>

  <span class="nc">Source</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"#Scala"</span><span class="o">,</span> <span class="s">"#akka"</span><span class="o">,</span> <span class="s">"#JVM"</span><span class="o">,</span> <span class="s">"#StReam"</span><span class="o">,</span> <span class="s">"#Kafka"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
    <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">toLowerCase</span><span class="o">)</span>
    <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nv">element</span><span class="o">.</span><span class="py">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span>
    <span class="o">.</span><span class="py">to</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">foreach</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="nf">println</span><span class="o">(</span><span class="n">element</span><span class="o">)))</span>
    <span class="o">.</span><span class="py">run</span><span class="o">()</span>  
<span class="o">}</span>
</code></pre></div></div>

<p>There are a few more tricks that can be applied to implement this in an even better way.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Source</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"#Scala"</span><span class="o">,</span> <span class="s">"#akka"</span><span class="o">,</span> <span class="s">"#JVM"</span><span class="o">,</span> <span class="s">"#StReam"</span><span class="o">,</span> <span class="s">"#Kafka"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">toLowerCase</span><span class="o">)</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">length</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">runForeach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="back-pressure-in-a-nutshell">Back-Pressure in a Nutshell</h2>

<p>To explain what back-pressure let’s consider the next two cases:</p>

<ul>
  <li>
    <p><em>Slow source/publisher, fast sink/consumer</em> is the ideal case because the publisher doesn’t need to slow down message emitting. Since the throughput of stream elements isn’t constant and the publisher can start emitting elements at a faster pace, back-pressure still should be enabled.</p>
  </li>
  <li>
    <p><em>Fast source/publisher, slow sink/consumer</em> is a case where we really need a back-pressure mechanism. Since the consumer is unable to deal with the rate of messages sent from the producer.</p>
  </li>
</ul>

<p>So the back-pressure is basically a mechanism where downstream components inform upstream components about the number of messages that can be received and buffered.</p>

<p>Akka Streams already has a back-pressure mechanism implemented and the user of the library doesn’t have to write any explicit back-pressure handling code since it’s built-in into Akka Streams operators. Anyhow,  Akka provides <em>buffer</em> method with overflow strategies, if you need it.</p>

<h2 id="real-example">Real Example</h2>

<p>Now when we are equipped with powerful tools we examined earlier, let’s refactor data processing application from <a href="/akka-actors-1/">first</a> and the <a href="/akka-actors-2/">second</a> article that uses Akka Actors to use Akka Streams.</p>

<p>As I mentioned several times <em>Source</em> is an entry point for every topology. So firstly we are going to create a source from the file path.
Akka gives us <em>FileIO</em> component which is a container of factory methods to create sinks and sources from files. Let’s review <em>fromPath</em> method signature.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fromPath</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Path</span><span class="o">,</span>
             <span class="n">chunkSize</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">8192</span><span class="o">)</span><span class="k">:</span> <span class="kt">Source</span><span class="o">[</span><span class="kt">ByteString</span>, <span class="kt">Future</span><span class="o">[</span><span class="kt">IOResult</span><span class="o">]]</span>
</code></pre></div></div>

<p>The <em>path</em> parameter is mandatory, while for the <em>chunkSize</em> default value is provided, that represents the size of each read operation.
Since I didn’t explain <em>Source</em> in detail, let’s do that now. <em>Source</em> has two type parameters, the first one represents a type of element which will be emitted downstream, in this particular case, it’s <em>ByteString</em>, Akka utility class which is an immutable data structure that provides a thread-safe way of working with bytes. When reading or writing to files Akka always uses this type. The second type parameter is the materialized value of the source. Materialized value is obtained when the runnable graph is executed. Since Akka Streams are asynchronous by default, it will return <em>Future</em> of <em>IOResult</em>. Scala <em>Future</em> represents a value that will be available at some point, or an exception if that value can’t be computed. A <em>Future</em> starts running concurrently when you create it and returns a result at some point. In order to start a <em>Future</em> implicit <em>ExecutionContext</em> must be available, since <em>Future</em> is potentially executed on a different thread.</p>

<p>Since <em>fromPath</em> method reads byte chunks, and our <a href="https://www.kaggle.com/shawon10/web-log-dataset"><em>weblog.csv</em></a> should be read line by line we need to use one more Akka Streams utility method from <em>Framing</em> module. Implementation of line delimiter flow goes like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">lineDelimiter</span><span class="k">:</span> <span class="kt">Flow</span><span class="o">[</span><span class="kt">ByteString</span>, <span class="kt">ByteString</span>, <span class="kt">NotUsed</span><span class="o">]</span> <span class="k">=</span>
  <span class="nv">Framing</span><span class="o">.</span><span class="py">delimiter</span><span class="o">(</span>
    <span class="nc">ByteString</span><span class="o">(</span><span class="s">"\n"</span><span class="o">),</span>
    <span class="n">maximumFrameLength</span> <span class="k">=</span> <span class="mi">256</span><span class="o">,</span>
    <span class="n">allowTruncation</span> <span class="k">=</span> <span class="kc">true</span>
  <span class="o">)</span>
</code></pre></div></div>

<p>To read more about this flow read <a href="https://doc.akka.io/api/akka/current/akka/stream/scaladsl/Framing$.html#delimiter(delimiter:akka.util.ByteString,maximumFrameLength:Int,allowTruncation:Boolean):akka.stream.scaladsl.Flow[akka.util.ByteString,akka.util.ByteString,akka.NotUsed]">offical documentation</a>. The method is pretty simple and commonly used, so I hope you understand that in full.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span>
    <span class="nv">getClass</span><span class="o">.</span><span class="py">getClassLoader</span><span class="o">.</span><span class="py">getResource</span><span class="o">(</span><span class="s">"data/weblog.csv"</span><span class="o">).</span><span class="py">getPath</span>
  <span class="o">)</span>

<span class="k">val</span> <span class="nv">source</span><span class="k">:</span> <span class="kt">Source</span><span class="o">[</span><span class="kt">ByteString</span>, <span class="kt">Future</span><span class="o">[</span><span class="kt">IOResult</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">FileIO</span>
  <span class="o">.</span><span class="py">fromPath</span><span class="o">(</span><span class="n">createPath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">lineDelimiter</span><span class="o">)</span>
</code></pre></div></div>
<p>Finally, we implemented a source that will read a file line by line, but it will emit <em>ByteString</em>, and we need <em>String</em>. Luckily, <em>ByteString</em> has a method that decodes it to UTF-8 encoded String. So we need to attach some flow that will preform that decoding. Of course, it’s gonna be <em>Flow[ByteString].map(…)</em>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">source</span><span class="k">:</span> <span class="kt">Source</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Future</span><span class="o">[</span><span class="kt">IOResult</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">FileIO</span>
  <span class="o">.</span><span class="py">fromPath</span><span class="o">(</span><span class="n">createPath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">lineDelimiter</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">byteString</span> <span class="k">=&gt;</span> <span class="nv">byteString</span><span class="o">.</span><span class="py">utf8String</span><span class="o">)</span> <span class="c1">// or .map(_.utf8String)</span>
</code></pre></div></div>

<p>When a source is modified to emit lines, we are ready to implement our processing logic, whom you are already familiar with. Keep every line that starts with valid ip address, extracts status code from it, and count the number of occurrences of status code in a giver file.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span>
    <span class="nv">getClass</span><span class="o">.</span><span class="py">getClassLoader</span><span class="o">.</span><span class="py">getResource</span><span class="o">(</span><span class="s">"data/weblog.csv"</span><span class="o">).</span><span class="py">getPath</span>
  <span class="o">)</span>

<span class="k">def</span> <span class="nf">validateIp</span><span class="o">(</span><span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">ipRegex</span> <span class="k">=</span> <span class="s">""".*?(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3}).*"""</span><span class="o">.</span><span class="py">r</span>
  <span class="nv">ipRegex</span><span class="o">.</span><span class="py">matches</span><span class="o">(</span><span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">","</span><span class="o">)(</span><span class="mi">0</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">def</span> <span class="nf">extractStatusCode</span><span class="o">(</span><span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
  <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">","</span><span class="o">).</span><span class="py">toList</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="k">_</span> <span class="o">::</span> <span class="k">_</span> <span class="o">::</span> <span class="k">_</span> <span class="o">::</span> <span class="n">status</span> <span class="o">::</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nv">status</span><span class="o">.</span><span class="py">trim</span>
  <span class="o">}</span>

<span class="nc">FileIO</span>
  <span class="o">.</span><span class="py">fromPath</span><span class="o">(</span><span class="n">createPath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">lineDelimiter</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">byteString</span> <span class="k">=&gt;</span> <span class="nv">byteString</span><span class="o">.</span><span class="py">utf8String</span><span class="o">)</span> <span class="c1">// or .map(_.utf8String)</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nf">validateIp</span><span class="o">(</span><span class="n">line</span><span class="o">))</span>         <span class="c1">// or .filter(validate)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nf">extractStatusCode</span><span class="o">(</span><span class="n">line</span><span class="o">))</span>     <span class="c1">// or .map(extractStatusCode)</span>
</code></pre></div></div>
<p>I hope you are already familiar with these helper methods since they are already implemented in the actor’s version of this application.</p>

<p>Now things can get a little bit complicated, but with a great <em>Akka Streams DSL</em>, it will look quite simple.
In order to count occurrences of each status code in a stream, we should branch it into sub-streams based on a key, in this case, it’s incoming status code. Akka Streams have <em>groupBy</em> operator, that accepts a maximum number of substreams, and function that will be used to compute key for a given record. In our case, the maximum number of substreams will be 5, since we have 5 distinct status codes (we know this based on the results of actor-based application). If we set a number of maximum substreams to be more than 5, the results will be the same, the output of <em>groupBy</em> will be 5 distinct streams since we have 5 unique values of status codes. Example of using <em>groupBy</em>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">groupBy</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">identity</span><span class="o">)</span>
</code></pre></div></div>
<p>Since we are partitioning stream by status code, and status code is already an element of the stream we will use <em>identity</em> function that just returns its input value.</p>

<p>After <em>groupBy</em> we will have 5 sub-stream. To calculate the number of occurrences we need to transform incoming status codes into <em>key-value</em> pair, where the key will be status code, and value will be 1 since it’s the first appearance of that key in a stream so far.
If you are familiar with <a href="https://spark.apache.org/">Apache Spark</a> you know that <em>reduceByKey</em> operator can do the job for us if we were using <em>PairRDD</em>. Unfortunately, Akka Streams doesn’t have that operator, but it can be easily implemented with <em>reduce</em> operator which accepts current and next value of a sub-stream yielding the next current value. After applying <em>reduce</em> operator we should merge all sub-streams into one stream, and pass it to the sink. In our case sink will be the Scala collection of tuples, where the first element of the tuple is the status code, and the second one is the count of occurrences.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">processorResult</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)]]</span> <span class="k">=</span> <span class="nc">FileIO</span>
  <span class="o">.</span><span class="py">fromPath</span><span class="o">(</span><span class="n">createPath</span><span class="o">)</span>
  <span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">lineDelimiter</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">byteString</span> <span class="k">=&gt;</span> <span class="nv">byteString</span><span class="o">.</span><span class="py">utf8String</span><span class="o">)</span> <span class="c1">// or .map(_.utf8String)</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nf">validateIp</span><span class="o">(</span><span class="n">line</span><span class="o">))</span>         <span class="c1">// or .filter(validate)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nf">extractStatusCode</span><span class="o">(</span><span class="n">line</span><span class="o">))</span>     <span class="c1">// or .map(extractStatusCode)</span>
  <span class="o">.</span><span class="py">groupBy</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">identity</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">statusCode</span> <span class="k">=&gt;</span> <span class="n">statusCode</span> <span class="o">-&gt;</span> <span class="mi">1L</span><span class="o">)</span>      <span class="c1">// or .map(_ -&gt; 1L)</span>
  <span class="o">.</span><span class="py">reduce</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nv">left</span><span class="o">.</span><span class="py">_1</span><span class="o">,</span> <span class="nv">left</span><span class="o">.</span><span class="py">_2</span> <span class="o">+</span> <span class="nv">right</span><span class="o">.</span><span class="py">_2</span><span class="o">))</span>
  <span class="o">.</span><span class="py">mergeSubstreams</span>
  <span class="o">.</span><span class="py">runWith</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)])</span>
</code></pre></div></div>

<p>Here is our completed stream processing topology with all connected components. A Runnable Graph is executed asynchronously, so a result of our processing is <em>Future</em> that contains a collection of tuples.</p>

<p>If <em>Future</em> is completed successfully we will sort our results and print them to the console and terminate our <em>ActorsSystem</em>. We learned that it’s best practice when Akka finished its job. Otherwise, we will terminate our <em>ActorsSystem</em>, and after that terminate the currently running JVM and exits the program with status code <strong>1</strong> which indicates that something went wrong.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">processorResult</span><span class="o">.</span><span class="py">onComplete</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nv">result</span><span class="o">.</span><span class="py">sortBy</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_2</span><span class="o">).</span><span class="py">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
    <span class="nv">system</span><span class="o">.</span><span class="py">terminate</span><span class="o">()</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nv">System</span><span class="o">.</span><span class="py">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="improving-throughput">Improving Throughput</h2>

<p>If you read <a href="/akka-actors-1/">first</a> and the <a href="/akka-actors-2/">second</a> part of the <em>Data processing with Akka Actors</em> series, you know that we parallelized our processing workflow, spawning multiple worker actors, and in a round-robin fashion distributed task to them. The goal of this chapter is to show you how to parallelize Akka Streams workflows. Just to let you know that in our case it won’t have any significant impact, it probably will be slower since our data is small, and spawning multiple actors will be overhead. But in the real world, it’s very important to understand and apply techniques that will be presented.</p>

<p>There are a few techniques for improving Akka Streams performance. We are going to talk about <em>Operator Fusion</em>, <em>Asynchronous Boundaries</em>, <em>mapAsync / mapAsyncUnordered</em> and <em>Buffering</em>.</p>

<p>When someone says that stream components/operators are fused that means that each stage of processing topology will be executed within the same <em>Actor</em>. Akka will fuse the stream components/operators by default. That’s the definition of <strong>Operator Fusion</strong>. Benefits of this are avoiding the overhead of asynchronous message passing across multiple actors and only one CPU core is allocated by fused components.</p>

<p>To enable parallel execution of stream operators, <strong>asynchronous boundaries</strong> must be inserted manually between operators using the <strong>async</strong> method.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Source</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"Akka"</span><span class="o">,</span> <span class="s">"SCALA"</span><span class="o">,</span> <span class="s">"kafka"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">toLowerCase</span><span class="o">)</span>
  <span class="o">.</span><span class="py">async</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"#$line"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">runForeach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
</code></pre></div></div>

<p>In this simple example, there’s a source of strings that we want to transform into hashtags. The asynchronous boundary is inserted between <em>map</em> operators, which means that the first two operators, <em>Source</em> and <em>map</em> will be executed on one actor, and other <em>map</em> and <em>Sink</em> on another one. Communication between the first two operators and the last two will be done via the standard actor’s message passing.</p>

<p><img src="http://localhost:4000/images/akka/async-boundary.png" class="center-image " /></p>

<p>In this diagram, operators inside the yellow box will be executed on one actor, but every other operator outside the box will be executed on another actor.
I hope that these two examples were enough to understand what an asynchronous boundary is.</p>

<p>Another way to introduce parallel processing into Akka Streams is to use methods <em>mapAsync</em> and <em>mapAsyncUnordered</em>.</p>

<p>The first argument of <em>mapAsyc</em> method is the number of <em>Futures</em> that shall run in parallel in order to compute the result. Another argument is a function that accepts element and returns a <em>Future</em> of a processing result. When <em>Future</em> is completed, the result is passed downstream. Regardless of their completion time, the incoming order of elements will be kept when results complete. In a case when order is not important  <em>mapAsycUnordered</em> should be used, because as soon as <em>Future</em> is completed results will be emitted downstream. This will improve performance.</p>

<p>Both <em>mapAsync</em> and <em>mapAsyncUnordered</em> method signatures are the same.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">mapAsync</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">parallelism</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Out</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Repr</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
<span class="k">def</span> <span class="nf">mapAsyncUnordered</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">parallelism</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Out</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Repr</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
</code></pre></div></div>

<p>The last trick we are going to talk about is buffering. It’s simplest of all we described before. To introduce buffering capabilities into your processing topology just insert <em>buffer</em> method between Akka Streams operators.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buffer</span><span class="o">(</span><span class="n">size</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">overflowStrategy</span><span class="k">:</span> <span class="kt">OverflowStrategy</span><span class="o">)</span><span class="k">:</span> <span class="kt">Repr</span><span class="o">[</span><span class="kt">Out</span><span class="o">]</span>
</code></pre></div></div>

<p>This method accepts the maximum number of elements that should be buffered, and an <em>OverflowStrategy</em>. There are a few overflow strategies provided by Akka Streams, to read more about them check the <a href="https://doc.akka.io/docs/akka/current/stream/operators/Source-or-Flow/buffer.html">official documentation</a>.</p>

<h2 id="refactoring">Refactoring</h2>

<p>So far, a lot of Akka Streams capabilities are exposed. In this chapter, the initial example will be refactored following some of the best practices.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">App</span> <span class="k">with</span> <span class="nc">LazyLogging</span> <span class="o">{</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"actor-system"</span><span class="o">)</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">dispatcher</span> <span class="k">=</span> <span class="nv">system</span><span class="o">.</span><span class="py">dispatcher</span>

  <span class="k">val</span> <span class="nv">processor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LogProcessor</span><span class="o">(</span><span class="s">"data/weblog.csv"</span><span class="o">)</span>
  <span class="k">val</span> <span class="nv">processorResult</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)]]</span> <span class="k">=</span> <span class="nv">processor</span><span class="o">.</span><span class="py">result</span>

  <span class="nv">processorResult</span><span class="o">.</span><span class="py">onComplete</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="nv">logger</span><span class="o">.</span><span class="py">info</span><span class="o">(</span><span class="s">"Stream completed successfully."</span><span class="o">)</span>
      <span class="nv">result</span><span class="o">.</span><span class="py">sortBy</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_2</span><span class="o">).</span><span class="py">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
      <span class="nv">system</span><span class="o">.</span><span class="py">terminate</span><span class="o">()</span>
    <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">ex</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="nv">logger</span><span class="o">.</span><span class="py">error</span><span class="o">(</span><span class="s">"Stream completion failed."</span><span class="o">,</span> <span class="n">ex</span><span class="o">)</span>
      <span class="nv">system</span><span class="o">.</span><span class="py">terminate</span><span class="o">()</span>
      <span class="nv">System</span><span class="o">.</span><span class="py">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here is the application entry point with defined <em>ActorSystem</em> and <em>dispatcher</em> which is an <em>ExecutionContext</em> needed to run <em>Futures</em>. In this example, I’m using dispatcher from the actor system, but best practice is to introduce separate one for <em>Future</em> execution.</p>

<p>In <em>LogProcessor</em> class all stream processing logic is contained. It accepts file path and implicitly requires an <em>ActorSystem</em> and <em>ExecutionContext</em>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">class</span> <span class="nc">LogProcessor</span><span class="o">(</span><span class="n">path</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
            <span class="o">(</span><span class="k">implicit</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">,</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">def</span> <span class="nf">result</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)]]</span> <span class="k">=</span>
    <span class="nc">FileIO</span>
      <span class="o">.</span><span class="py">fromPath</span><span class="o">(</span><span class="n">createPath</span><span class="o">)</span>
      <span class="o">.</span><span class="py">via</span><span class="o">(</span><span class="n">lineDelimiter</span><span class="o">)</span>
      <span class="o">.</span><span class="py">mapAsyncUnordered</span><span class="o">(</span><span class="mi">2</span><span class="o">)(</span><span class="n">data</span> <span class="k">=&gt;</span> <span class="nc">Future</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">utf8String</span><span class="o">))</span>
      <span class="o">.</span><span class="py">async</span>
      <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">validateIp</span><span class="o">)</span>
      <span class="o">.</span><span class="py">mapAsyncUnordered</span><span class="o">(</span><span class="mi">2</span><span class="o">)(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nf">extractStatusCode</span><span class="o">(</span><span class="n">line</span><span class="o">))</span>
      <span class="o">.</span><span class="py">buffer</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="nv">OverflowStrategy</span><span class="o">.</span><span class="py">backpressure</span><span class="o">)</span>
      <span class="o">.</span><span class="py">groupBy</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="n">identity</span><span class="o">)</span>
      <span class="o">.</span><span class="py">mapAsyncUnordered</span><span class="o">(</span><span class="mi">2</span><span class="o">)(</span><span class="n">status</span> <span class="k">=&gt;</span> <span class="nc">Future</span><span class="o">(</span><span class="n">status</span> <span class="o">-&gt;</span> <span class="mi">1L</span><span class="o">))</span>
      <span class="o">.</span><span class="py">reduce</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nv">left</span><span class="o">.</span><span class="py">_1</span><span class="o">,</span> <span class="nv">left</span><span class="o">.</span><span class="py">_2</span> <span class="o">+</span> <span class="nv">right</span><span class="o">.</span><span class="py">_2</span><span class="o">))</span>
      <span class="o">.</span><span class="py">mergeSubstreams</span>
      <span class="o">.</span><span class="py">runWith</span><span class="o">(</span><span class="nv">Sink</span><span class="o">.</span><span class="py">seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">)])</span>

  <span class="k">private</span> <span class="k">val</span> <span class="nv">createPath</span><span class="k">:</span> <span class="kt">Path</span> <span class="o">=</span>
    <span class="nv">Paths</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nv">getClass</span><span class="o">.</span><span class="py">getClassLoader</span><span class="o">.</span><span class="py">getResource</span><span class="o">(</span><span class="n">path</span><span class="o">).</span><span class="py">getPath</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">val</span> <span class="nv">lineDelimiter</span><span class="k">:</span> <span class="kt">Flow</span><span class="o">[</span><span class="kt">ByteString</span>, <span class="kt">ByteString</span>, <span class="kt">NotUsed</span><span class="o">]</span> <span class="k">=</span>
    <span class="nv">Framing</span><span class="o">.</span><span class="py">delimiter</span><span class="o">(</span>
      <span class="nc">ByteString</span><span class="o">(</span><span class="s">"\n"</span><span class="o">),</span>
      <span class="n">maximumFrameLength</span> <span class="k">=</span> <span class="mi">256</span><span class="o">,</span>
      <span class="n">allowTruncation</span> <span class="k">=</span> <span class="kc">true</span>
    <span class="o">)</span>

  <span class="k">private</span> <span class="k">def</span> <span class="nf">validateIp</span><span class="o">(</span><span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">ipRegex</span> <span class="k">=</span> <span class="s">""".*?(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3}).*"""</span><span class="o">.</span><span class="py">r</span>
    <span class="nv">ipRegex</span><span class="o">.</span><span class="py">matches</span><span class="o">(</span><span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">","</span><span class="o">)(</span><span class="mi">0</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="nf">extractStatusCode</span><span class="o">(</span><span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Future</span> <span class="o">{</span>
    <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">","</span><span class="o">).</span><span class="py">toList</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="k">_</span> <span class="o">::</span> <span class="k">_</span> <span class="o">::</span> <span class="k">_</span> <span class="o">::</span> <span class="n">status</span> <span class="o">::</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nv">status</span><span class="o">.</span><span class="py">trim</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In the result method, I showed how to introduce asynchronous boundaries and enable parallel processing of elements of a stream. Probably this is not optimal topology, but I introduced them for learning purposes. You should be careful when using these techniques in stream processing because there are no rules on how to use them. Different topologies should be designed and benchmarked in order to increase performances since I already mentioned that they introduce the overhead of asynchronous message passing, but there are cases where this could significantly improve the overall performance of a streaming workflow.</p>

<h2 id="summary">Summary</h2>

<p>In this article, a lot of Akka Streams capabilities are explained with a few examples, but it’s is just a tip of the iceberg. There is the Akka Streams Graph DSL, which helps us to build non-linear and quite complex stream processing topologies. Also, I did not talk about error handling and recovery. Both of these may be the subject of the next articles.</p>

<p>If you are interested in source code, here is the <a href="https://github.com/aleksandarskrbic/akka-data-processing/tree/master/streams/src/main">Github repository</a> that complements examples from this article.</p>

<p>You can find me at:</p>
<ul>
  <li><a href="https://www.linkedin.com/in/aleksandar-skrbic/">Linkedin</a></li>
  <li><a href="https://github.com/aleksandarskrbic">Github</a></li>
</ul>

<p>Or just send me a question to <a href="">skrbic.alexa@gmail.com</a></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#akka-streams" class="page__taxonomy-item" rel="tag">akka streams</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#akka" class="page__taxonomy-item" rel="tag">akka</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#big-data" class="page__taxonomy-item" rel="tag">big data</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#jvm" class="page__taxonomy-item" rel="tag">jvm</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#scala" class="page__taxonomy-item" rel="tag">scala</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-25T00:00:00+02:00">April 25, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=The+Power+of+Akka+Streams%20http%3A%2F%2Flocalhost%3A4000%2Fpower-of-akka-streams%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fpower-of-akka-streams%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fpower-of-akka-streams%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fpower-of-akka-streams%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/akka-actors-2/" class="pagination--pager" title="Data processing with Akka Actors: Part II
">Previous</a>
    
    
      <a href="http://localhost:4000/a-taste-of-functional-java/" class="pagination--pager" title="A Taste of Functional Java
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/functional-effects-with-zio/" rel="permalink">Functional Effects with ZIO
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  15 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, JVM, ZIO, Functional Programming
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/a-taste-of-functional-java/" rel="permalink">A Taste of Functional Java
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  19 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Java, JVM, Functional Programming
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/akka-actors-2/" rel="permalink">Data processing with Akka Actors: Part II
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, Akka, JVM, Big Data
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/akka-actors-1/" rel="permalink">Data processing with Akka Actors: Part I
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, Akka, JVM, Big Data
</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="https://github.com/aleksandarskrbic"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Aleksandar Skrbic. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://localhost:4000/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>










  </body>
</html>