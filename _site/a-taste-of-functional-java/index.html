<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.9.0 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>A Taste of Functional Java - Aleksandar Skrbic</title>
<meta name="description" content="Java, JVM, Functional Programming">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Aleksandar Skrbic">
<meta property="og:title" content="A Taste of Functional Java">
<meta property="og:url" content="http://localhost:4000/a-taste-of-functional-java/">


  <meta property="og:description" content="Java, JVM, Functional Programming">



  <meta property="og:image" content="http://localhost:4000/images/java/fp-in-java.jpg">





  <meta property="article:published_time" content="2020-05-24T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/a-taste-of-functional-java/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Aleksandar Skrbic",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Aleksandar Skrbic Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">Aleksandar Skrbic</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/search/" >Search Articles</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about/" >About</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="http://localhost:4000/images/java/fp-in-java.jpg" alt="A Taste of Functional Java" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Aleksandar Skrbic</h3>
    
    
      <p class="author__bio" itemprop="description">
        Blogging mostly about distributed systems, databases and big data.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Novi Sad, Serbia</span>
        </li>
      

      

      
        <li>
          <a href="mailto:skrbic.alexa@gmail.com">
            <meta itemprop="email" content="skrbic.alexa@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/skrbic_a" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/aleksandar-skrbic" itemprop="sameAs">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/aleksandarskrbic" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="A Taste of Functional Java">
    <meta itemprop="description" content="Java, JVM, Functional Programming">
    <meta itemprop="datePublished" content="May 24, 2020">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">A Taste of Functional Java
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  19 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        
<p>There are a lot of different definitions of what functional programming is. For people new to it, it’s can be really hard to understand what it actually is, since there are a lot of materials related to it, but rarely you will find one that will clearly present basics and gives you a broader picture. The result of that is that I met a lot of developers who things that Java Stream API is functional programming, or even worse some of them identify AWS Lambdas with functional programming. Yes, Java Stream API has something to do with functional programming, but it’s just a really small part of it. My goal is just to try to give you a high-level overview of pure functional programming, how it is usually referenced among functional programmers.</p>

<p>If someone asks me should Java be used for functional programming, my answer will be no. Usually, as a (junior) developer, you don’t have a choice of technology, but what can you do is to make that Java code better by making it more functional.
Java is not a friendly language for functional programming like Scala or Haskell are, but introducing some functional structures and concepts into your Java code will definitely improve maintainability, safety, readability, and general quality of your codebase. Even if we are going to use a few functional concepts in our Java applications, we can’t say that we are writing purely functional code, because some rules of functional programming will be violated. First, let’s review some core concepts of functional programming and see why it can be extremely hard to satisfy all those rules, especially in Java.</p>

<h2 id="really-short-definition-of-fp">Really short definition of FP</h2>

<p>Functional programming is programming with functions. This sounds pretty simple and you can say that you are already doing it. But there is a trick here of course. Function in functional programming is treated as the one in mathematics: <em>binary relation that map arguments to result</em>.</p>

<p>These functions are often referred to as <em>pure functions</em> and are not allowed to perform any side effects. So now when you know that side effects like mutations, exceptions, and I/O operations are forbidden in a purely functional world, it seems that it’s impossible to write purely functional software. Once you start digging deeper into the functional world, you will realize that is possible, but in Java it’s just not worth it. So instead of going fully functional, we will explore some functional structures and use them to solve your day to day problems.</p>

<figure>
  <img src="http://localhost:4000/images/fp/pure-functions.png" class="center-image " />
    <figcaption>Image source: <a href="https://impurepics.com/">impurepics.com</a></figcaption>
</figure>

<p>Now I have to tell you that we will not talk anymore about pure functional programming. The goal of this article is to equip you with a few recipes that you can apply in the real world, even in your next pull request. I’m planning to walk you through abstracting over control structures, dealing with missing values, and exception handling in a functional style.</p>

<h2 id="motivating-example">Motivating Example</h2>

<p>Imagine that we are developing an application that has information about all training centers in our city. A data model is simple, you have a collection of training centers, every training center has a schedule, where a schedule is represented as a collection of time slots, where every time slot is identified by the day of the week, and optionally can contain training session.
You as a developer have a task to find all training sessions for a given day. Here is a solution that I think a majority of Java developers will provide.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="nf">findSessionsByDay</span><span class="o">(</span><span class="kd">final</span> <span class="nc">DayOfWeek</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingCenter</span><span class="o">&gt;</span> <span class="n">trainingCenters</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="n">sessions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">TrainingCenter</span> <span class="n">trainingCenter</span> <span class="o">:</span> <span class="n">trainingCenters</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TimeSlot</span><span class="o">&gt;</span> <span class="n">schedule</span> <span class="o">=</span> <span class="n">trainingCenter</span><span class="o">.</span><span class="na">schedule</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">TimeSlot</span> <span class="n">slot</span> <span class="o">:</span> <span class="n">schedule</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">slot</span><span class="o">.</span><span class="na">day</span><span class="o">()</span> <span class="o">==</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">final</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="n">session</span> <span class="o">=</span> <span class="n">slot</span><span class="o">.</span><span class="na">session</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">sessions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">sessions</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>I can’t say this solution is wrong, but every time I see something similar to this I start asking myself why are we repeating ourselves over and over again while writing loops. It’s clearly a boilerplate and it can be avoided by abstract over it. We should describe what we want our program to do, and not wasting time writing the same loops all the time and worry about loop index and temporary variables that will help us to finish our task.</p>

<p>Let’s review another solution probably written by developer who just heard about Stream API and how cool it is.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="nf">findSessionsByDay</span><span class="o">(</span><span class="kd">final</span> <span class="nc">DayOfWeek</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="n">sessions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">trainingCenter</span> <span class="o">-&gt;</span>
                    <span class="n">trainingCenter</span><span class="o">.</span><span class="na">schedule</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">timeSlot</span> <span class="o">-&gt;</span> <span class="n">timeSlot</span><span class="o">.</span><span class="na">day</span><span class="o">()</span> <span class="o">==</span> <span class="n">day</span><span class="o">)</span>
                            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">timeSlot</span> <span class="o">-&gt;</span> <span class="n">timeSlot</span><span class="o">.</span><span class="na">session</span><span class="o">())</span>
                            <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">session</span> <span class="o">-&gt;</span> <span class="o">{</span>
                                <span class="k">if</span> <span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
                                    <span class="n">sessions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
                                <span class="o">}</span>
                            <span class="o">})</span>
            <span class="o">);</span>
    <span class="k">return</span> <span class="n">sessions</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Wow, looks cool, looks declarative but I think it’s worse than the first solution. It demonstrates insufficient knowledge and understanding of Stream API and the whole point about it. The first mistake is using <em>forEach</em> since it can be replaced with some other operation, and the second one is <em>if</em> expression in a <em>forEach</em> instead of applying <em>filter</em> on <em>Optional</em>. Often people get confused when they should deal with nested structures like <em>List of Optionals</em> or <em>Stream of Streams</em>. So let’s see how we should solve this problem.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="nf">findSessionsByDay</span><span class="o">(</span><span class="kd">final</span> <span class="nc">DayOfWeek</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
          <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">trainingCenter</span> <span class="o">-&gt;</span> <span class="n">trainingCenter</span><span class="o">.</span><span class="na">schedule</span><span class="o">().</span><span class="na">stream</span><span class="o">())</span>
          <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">timeSlot</span> <span class="o">-&gt;</span> <span class="n">timeSlot</span><span class="o">.</span><span class="na">day</span><span class="o">()</span> <span class="o">==</span> <span class="n">day</span><span class="o">)</span>
          <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">TimeSlot:</span><span class="o">:</span><span class="n">session</span><span class="o">)</span>
          <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">Optional:</span><span class="o">:</span><span class="n">isPresent</span><span class="o">)</span>
          <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Optional:</span><span class="o">:</span><span class="n">get</span><span class="o">)</span>
          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>I hope you are able to capture the difference in this approach. We see that one <em>flatMap</em> solves our hard problem of nested structures. Maybe the easiest way to think about <em>flatMap</em> is that it allows you to remove one level of nesting or unwraps inner structure.
If you know that this solution can be even shorter than you are a probably Scala developer.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TrainingSession</span><span class="o">&gt;</span> <span class="nf">findSessionsByDay</span><span class="o">(</span><span class="kd">final</span> <span class="nc">DayOfWeek</span> <span class="n">day</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">tc</span> <span class="o">-&gt;</span> <span class="n">tc</span><span class="o">.</span><span class="na">schedule</span><span class="o">().</span><span class="na">stream</span><span class="o">())</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">ts</span> <span class="o">-&gt;</span> <span class="n">ts</span><span class="o">.</span><span class="na">day</span><span class="o">()</span> <span class="o">==</span> <span class="n">day</span><span class="o">)</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">ts</span> <span class="o">-&gt;</span>
                    <span class="n">ts</span><span class="o">.</span><span class="na">session</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="nl">Stream:</span><span class="o">:</span><span class="n">of</span><span class="o">).</span><span class="na">orElseGet</span><span class="o">(</span><span class="nl">Stream:</span><span class="o">:</span><span class="n">empty</span><span class="o">)</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>
<p>This is our final solution and summary is that we reduced <em>15+</em> lines of code that contains two <em>for loops</em> and two <em>if expressions</em> with basically a one-liner, just with the two <em>flatMap</em> operations, and one <em>filter</em>.</p>

<p>I’m sure that I got your attention now, and that you finally realized the power of declarative approach and functional style of programming. The solution is pretty readable and clearly expresses what is our intention. Maybe you noticed that I used shorter variable names which is very common practice in a functional world, even though a typical Java developer will think that this is not expressive enough. 
There is no code nesting and ugly pyramids of doom, repeatable for loops, extensive usage of if expressions, and creation of temporary variables that will be filled upon iteration.</p>

<p>In the next few chapters, I will present a couple of concepts that are usually used in a functional world but unfortunately are not available in Java Standard Library. We are going to use <a href="https://www.vavr.io/">Vavr</a>, which is a Java library that provides us immutable collections that already have operations like <em>map</em>, <em>flatMap</em>, <em>filter</em>, and others without the need to transform it to the <em>Stream</em> first. Besides new collection API, Vavr gives us a few monadic containers types like <em>Option</em>, <em>Try</em>, and <em>Either</em> that we are going to explore to the details. These types are pretty interesting and by applying them your code becomes safer, declarative, and composable.</p>

<p><a href="https://www.vavr.io/vavr-docs/#_option">Vavr Option</a> is similar to <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Java Optional</a>, but there are a couple of problems with Core Java implementation. If you want to find more about it, check the next articles:</p>

<ul>
  <li><a href="https://blog.developer.atlassian.com/optional-broken/">Why java.util.Optional is broken</a></li>
  <li><a href="http://blog.vavr.io/the-agonizing-death-of-an-astronaut/">The agonizing death of an astronaut</a></li>
  <li><a href="https://softwaremill.com/do-we-have-better-option-here/">Do we have a better Option here?</a></li>
  <li><a href="https://blog.senacor.com/in-praise-of-vavrs-option/">In praise of Vavr’s Option</a></li>
  <li><a href="https://www.sitepoint.com/how-optional-breaks-the-monad-laws-and-why-it-matters/">How Optional Breaks the Monad Laws and Why It Matters</a></li>
</ul>

<h2 id="option-type">Option Type</h2>

<p>Option is a container type which represents an optional value. It helps to avoid <em>NullPointerException</em> in our code and to deal with missing values in a clear and elegant way. It is often used in data retrieval or validation logic when you don’t need the details about potential errors. If an error happens <em>Option</em> just will be empty. <a href="https://www.vavr.io/vavr-docs/#_option">Vavr Option</a> implementation is pretty similar to the <a href="https://www.scala-lang.org/api/current/scala/Option.html">Option in Scala</a>, where instances of <em>Option</em> are either an instance of <em>Some</em> or the <em>None</em>. Some of the common mistakes that developers are making while using <em>Option</em> will be reviewed in this chapter.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">getFromRepository</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">getFromCache</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Now we need to add another method to the <em>UserService</em>. Our task is to find a user by id, but first, try to get a user from the cache and if it’s not in the cache, then try to find it in the repository. If the user is missing from the repository throw some exception. A typical implementation that I have seen a lot of times is pretty similar to this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">fromCache</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">fromCache</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">fromRepository</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">fromRepository</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">userFromRepository</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">fromCache</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Again, no one can say it is an incorrect solution, but it just misses the point of <em>Option</em>. <em>If expressions</em> with unnecessary checks are still here. Earlier I mentioned that it is a <em>monadic type</em>, which means that our <em>Options</em> can be composed. This is probably the shortest explanation ever and if you are not planning to go fully functional you don’t have to know more about it, but just want to say that <em>Monad</em> is the essential functional structure and it would be nice to find out more about it.
Now let’s review the solution that demonstrates proper usage of <em>Options</em>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">.</span><span class="na">getOrElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>A much shorter solution with clear intentions without <em>if</em> checks. I think this code is pretty descriptive. Get a user from the cache or else get it from the repository, if there is no user throw exception. Methods like <em>orElse</em> and <em>getOrElseThrow</em> gives us possibility of composing multiple <em>Option</em> types, and you should use it all the time in order to avoid imperative style.</p>

<p>If we need to modify our method to get the user in JSON format, code will become pretty messy, since there is a possibility of exception during deserialization of the object. First, we need to introduce a method for deserialization that can possibly throw an exception.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">String</span> <span class="nf">toJson</span><span class="o">(</span><span class="kd">final</span> <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JsonProcessingException</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Now we should modify our method that after getting the user will map it to he JSON, or return an empty JSON object.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUserJson</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">fromCache</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">fromCache</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">fromRepository</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">fromRepository</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">toJson</span><span class="o">(</span><span class="n">fromRepository</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">JsonProcessingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle, log exception</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">toJson</span><span class="o">(</span><span class="n">fromCache</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">JsonProcessingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle, log exception</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="s">"{}"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Huh, pretty messy if you ask me. Let’s try Java 8 approach with Stream API, maybe it will be a little bit better.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUserJson</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">userId</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">JsonProcessingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// handle, log exception</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="s">"{}"</span><span class="o">;</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">getOrElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The more expressive and shorter solution, but there is a  huge lambda expression in <em>map</em> with <em>try/catch</em> block which probably is not a great solution, but it is the best if you are using Java since there is no way to avoid exception handling. For those coming from Scala <em>Try</em> is a natural solution for this problem.</p>

<h2 id="try-or-throw">Try or Throw?</h2>

<p><em>Try</em> is a container type which represents a computation that may either result in an exception, or return a successfully computed value.
Instances of <em>Try</em>, are either an instance of <em>Success</em> or <em>Failure</em>. <em>Try</em> enables us to overcome problems with exception handling we had. Here is an improved solution utilizing the <em>Try</em>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUserJson</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">toJson</span><span class="o">(</span><span class="n">user</span><span class="o">)))</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">userTry</span> <span class="o">-&gt;</span> <span class="n">userTry</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">()</span>
                            <span class="o">?</span> <span class="nc">Option</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">userTry</span><span class="o">.</span><span class="na">get</span><span class="o">())</span>
                            <span class="o">:</span> <span class="nc">Option</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"{}"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">getOrElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>What we did to improve our code is basically just wrapping the invocation of an unsafe method into <em>Try</em>. Methods have exactly the same meaning as the previous one but it much more readable. If the method was successfully executed, the return value will be wrapped into <em>Try</em>. On the other hand, if an exception occurs it will not interrupt our program, it will be just wrapped into <em>Try</em> and we have absolute control about it. In <em>flatMap</em> block, we first check if <em>Try</em> is succeeded and then get it’s value if it is. If computation failed, you can extract exception out of Try by invoking a method <em>getCause</em>. If you want a more explicit solution here it is.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUserJsonBetter</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orElse</span><span class="o">(</span><span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">toJson</span><span class="o">(</span><span class="n">user</span><span class="o">))</span>
                    <span class="o">.</span><span class="na">recover</span><span class="o">(</span><span class="nc">JsonProcessingException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"{}"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Try:</span><span class="o">:</span><span class="n">get</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getOrElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="s">"User not found"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>What’s new in this approach is using <em>recover</em> method of <em>Try</em>, which accepts the type of exception, and a value that will be used upon recovery. You are able to chain multiple <em>recover</em> methods with different exception types. Since we implemented a recovery mechanism for our <em>Try</em> that handles all possible exception(in this case it’s just <em>JsonProcessingException</em>), our <em>Try</em> can’t fail, so in the next <em>map</em> we are safe to get the value. And of course, these two <em>map</em> operations won’t be executed if there is no user.</p>

<p>There is another recovery mechanism available for <em>Try</em>. To better demonstrate it usage, let’s write some code again. Consider you have <em>UserService</em> like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">getFromRepository</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoUserInRepositoryException</span><span class="o">(</span><span class="s">"No user in repository"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">getFromCache</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Option</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NoUserInCacheException</span><span class="o">(</span><span class="s">"No user in cache"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Similarly to our first <em>UserService</em>, but this one throws an exception when user is not present. So how to implement the safest possible method to retrieve a user in a JSON format, when we know there are multiple exceptions than can occur.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Try</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getUser</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">.</span><span class="na">recoverWith</span><span class="o">(</span>
                    <span class="nc">NoUserInCacheException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                    <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">service</span><span class="o">.</span><span class="na">getFromRepository</span><span class="o">(</span><span class="n">id</span><span class="o">))</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">recoverWith</span><span class="o">(</span>
                    <span class="nc">NoUserInRepositoryException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
                    <span class="nc">Try</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="k">new</span> <span class="nc">User</span><span class="o">(-</span><span class="mi">1L</span><span class="o">,</span> <span class="s">"default"</span><span class="o">))</span>
            <span class="o">)</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">toJson</span><span class="o">(</span><span class="n">user</span><span class="o">)));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Here is another example of how to use <em>Try</em> and it perfectly fine to return <em>Try&lt;</em>String<em>&gt;</em> from a method. We have a strategy on how to handle exceptions if the user is missing but we don’t want to handle exception related to JSON serialization, so we just pushed that responsibility to the client-side. A developer who is going to use our method is aware that exceptions are possible since we are returning a <em>Try&lt;</em>String<em>&gt;</em> and on him is to decide how to deal with potential exceptions. The first exception that can happen is when there is no user in a cache, so if <em>NoUserInCacheException</em> occurs, we will recover from that with another <em>Try</em> which again can fail with <em>NoUserInRepositoryException</em>, but from that,  we are always recovered successfully with the default user that we defined. Here I used <em>recoverWith</em> instead of <em>recover</em>, and the difference is that as a second parameter <em>recoverWith</em> requires an instance of a <em>Try</em>, while recover accept some value or just a regular method.</p>

<h2 id="the-beauty-of-functional-style">The Beauty of Functional Style</h2>

<p>Once again I’m using the term <em>functional style</em> because our code looks functional-ish, but it’s far from ideal by functional programming standards. So just to point out that we are not allowed to call our code functional, but saying that is written in a functional style is acceptable. Later I will refer you to the resources about pure functional programming in Scala since it’s not completely possible in Java, at least that I know. Scala has a few state of the art libraries that unlocks the full potential of functional programming. Even though we are far that and we started by just introducing basic functional concepts we are able to notice that our code becomes better.</p>

<p>Now let’s see some more code. We have to implement a method that will accept a collection of endpoints and we need to send a request to them and extract some information from the response. Information that we need from the response is first and last name of the user, so before we start to write our business logic we need to implement a class that will contain our user details.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">UserInfo</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">UserInfo</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">firstName</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// getter and setters</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now typical before Java 8 approach would go like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserInfo</span><span class="o">&gt;</span> <span class="nf">fetch</span><span class="o">(</span><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserInfo</span><span class="o">&gt;</span> <span class="n">responses</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="k">for</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">url</span> <span class="o">:</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">HttpGet</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpGet</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        
        <span class="k">try</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="nc">HttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="kd">final</span> <span class="nc">String</span> <span class="n">json</span> <span class="o">=</span> <span class="nc">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
                <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(),</span>
                <span class="s">"UTF-8"</span>
            <span class="o">);</span>
            <span class="kd">final</span> <span class="nc">JsonNode</span> <span class="n">data</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readTree</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="na">path</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
            <span class="kd">final</span> <span class="nc">UserInfo</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserInfo</span><span class="o">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span>
                    <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">()</span>
            <span class="o">);</span>
            <span class="n">responses</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">userInfo</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// handle exception</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">responses</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>With a Standard Java library, we had to implement a simple temporary class just to represent a user with two fields, and then we have a huge method where multiple exceptions can occur, but we wrapped it all into one <em>try/catch</em> block. Java 8 probably can help us to improve our code, but not as much as Vavr can. First, let’s review Java 8 solution:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">UserInfo</span><span class="o">&gt;</span> <span class="nf">fetch</span><span class="o">(</span><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">urls</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">HttpGet:</span><span class="o">:</span><span class="k">new</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">req</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="nc">UserInfo</span> <span class="n">userInfo</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="kd">final</span> <span class="nc">HttpResponse</span> <span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
                    <span class="kd">final</span> <span class="nc">String</span> <span class="n">json</span> <span class="o">=</span> <span class="nc">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span>
                            <span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(),</span>
                            <span class="s">"UTF-8"</span>
                    <span class="o">);</span>
                    <span class="kd">final</span> <span class="nc">JsonNode</span> <span class="n">data</span> <span class="o">=</span> 
                            <span class="n">mapper</span><span class="o">.</span><span class="na">readTree</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="na">path</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
                    <span class="n">userInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserInfo</span><span class="o">(</span>
                            <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span>
                            <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">()</span>
                    <span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// handle exception</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">userInfo</span><span class="o">);</span>
            <span class="o">})</span>
            <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">u</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Stream:</span><span class="o">:</span><span class="n">of</span><span class="o">).</span><span class="na">orElseGet</span><span class="o">(</span><span class="nl">Stream:</span><span class="o">:</span><span class="n">empty</span><span class="o">))</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Maybe a little bit better, but once again huge lambda expression with <em>try/catch</em> which is inevitable without data type like we introduced in a previous chapter. If you are a little bit confused with a flatMap part it can be replaced with these two lines:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="nl">Optional:</span><span class="o">:</span><span class="n">isPresent</span><span class="o">)</span>
<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Optional:</span><span class="o">:</span><span class="n">get</span><span class="o">)</span>
</code></pre></div></div>

<p>Basically it just checks whether an <em>Optional</em> is present or not before trying to get inside the value. Since Java Stream API is not ideal and it represents a try to imitate compositions of combinators like <em>map</em> and <em>flatMap</em> on collections of more functional languages, which support combinators by default. Not so good implementation of Stream API forces us to wrap the result of <em>Option</em> into that <em>flatMap</em> operation into Stream, which won’t be necessary if Java Collections would be more functional and had combinators implemented on them directly.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tuple2</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="nf">fetch</span><span class="o">(</span><span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">urls</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">urls</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">HttpGet:</span><span class="o">:</span><span class="k">new</span><span class="o">)</span>
        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">req</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">http</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">req</span><span class="o">)))</span>
        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">res</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="nc">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(),</span> <span class="s">"UTF-8"</span><span class="o">)))</span>
        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">entity</span> <span class="o">-&gt;</span> <span class="nc">Try</span><span class="o">.</span><span class="na">of</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readTree</span><span class="o">(</span><span class="n">entity</span><span class="o">).</span><span class="na">path</span><span class="o">(</span><span class="s">"data"</span><span class="o">)))</span>
        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">json</span> <span class="o">-&gt;</span> <span class="nc">Tuple</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="n">json</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">(),</span>
                <span class="n">json</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">).</span><span class="na">toString</span><span class="o">())</span>
        <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>And finally here is a Vavr based solution, which is shorter and we even didn’t have to implement some temporary class to store results, we just used <a href="https://www.vavr.io/vavr-docs/#_tuples">Tuple</a>, which is extremely useful in a lot of cases, but unfortunately, Java doesn’t support them by default.
Of course, this method would be much more compacted if we would extract all those methods for sending requests, parsing JSON, and mapping to Tuple. We wrote a lot of code utilizing <em>Try</em> type, and to summarize I want to note that <em>Try</em> is a great approach to gain full control of your code by taming exceptions, which are tricky and very dangerous since they are able to secretly change the flow of a program. Simply use <em>Try</em> whenever you need to make safe wrappers around API, whom you do not have control of. And if you want even more expressive approach to deal with exceptions, but equally powerful like a <em>Try</em> there is a solution for it.</p>

<h2 id="either-type">Either Type</h2>

<p><em>Either</em> represents a value of two possible types. An <em>Either</em> is either a <em>Left</em> or a <em>Right</em>. Both Left and Right can wrap any type. By convention Right is right, so it contains the successful result, and the Left side should contain the error. This is not mandatory but you should stick to the convention. I bet you noticed some similarity here with a <em>Try</em>, and the only difference is that error in <em>Try</em> must be an instance of a <em>Throwable</em>, while an error in <em>Either</em> can be whatever you want. You can use the custom message as a <em>String</em>, or you can wrap exception. Example usage of <em>Either</em>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Either</span><span class="o">&lt;</span><span class="nc">JsonProcessingException</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">toJson</span><span class="o">(</span><span class="kd">final</span> <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Either</span><span class="o">.</span><span class="na">right</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="kd">final</span> <span class="nc">JsonProcessingException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Either</span><span class="o">.</span><span class="na">left</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>As I mentioned earlier, <em>Either</em> is more expressive than a <em>Try</em> since from a method signature you have complete knowledge about behaviour of a method. Are you going to use <em>Either</em> or <em>Try</em> is totally up to you and whatever you choose it certainly better than constantly using <em>try/catch</em> blocks and checked exceptions. <em>Either</em> have very rich <a href="https://www.javadoc.io/doc/io.vavr/vavr/0.9.0/io/vavr/control/Either.html">API</a> that you should explore. What you should know is that <em>Either</em> have also <em>map</em> which will apply mapping function on the <em>Right</em> side while completely ignoring <em>Left</em> side. Even if you need to <em>map</em> over <em>Left</em> side you have <em>mapLeft</em> method. Also <em>bimap</em> method is available which accepts two functions, left and right mapper functions. Also <em>flatMap</em> and <em>filter</em> combinators are available, which by default operates on the <em>Right</em> side. There is a plenty of interesting operators available in the <em>Either</em> and I just presented the most used ones.</p>

<h2 id="scala-and-functional-programming">Scala and Functional Programming</h2>

<p>Mentioned earlier, Scala is much more friendly language for functional programming than Java and all concepts that I presented here with Java and Vavr, are natively supported by Scala. Of course, there is much more futures that make Scala more powerful than Java. There are few libraries that you should be aware of if you are interested in purely functional programming in Scala. Most popular ones are: <a href="https://zio.dev/">ZIO</a>, <a href="https://typelevel.org/cats/">Cats</a> and <a href="https://typelevel.org/cats-effect/">Cats Effect</a>, <a href="https://monix.io/">Monix</a>, and <a href="https://scalaz.github.io/7/">Scalaz</a>.</p>

<h2 id="summary">Summary</h2>

<p>We cover a lot of new concepts that are pretty unusual in a Java world. To be honest they are simple enough yet unbelievably powerful, whose effects just can’t be ignored. Amount of confidence you felt for the first working with <em>Try</em> or <em>Either</em> should be present all the time while coding, which is not the case while handling the exceptions in a traditional way. Also, the composition of <em>Options</em> is pretty cool, and also I noticed that a lot of Java developers who are using it are not aware of that you can apply <em>map</em>, <em>flatMap</em>, and <em>filter</em> on it, so I tried to show some common patterns on how to utilize those concepts in a right way.</p>

<p>I hope that you have learned something new and that you realize the benefits offered by writing Java in a functional style. Of course, there are a lot of concepts that are not covered like using immutable collections and immutable data types, but I think it’s enough to start improving your Java codebase.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#fp" class="page__taxonomy-item" rel="tag">fp</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#java" class="page__taxonomy-item" rel="tag">java</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#jvm" class="page__taxonomy-item" rel="tag">jvm</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-05-24T00:00:00+02:00">May 24, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=A+Taste+of+Functional+Java%20http%3A%2F%2Flocalhost%3A4000%2Fa-taste-of-functional-java%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fa-taste-of-functional-java%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fa-taste-of-functional-java%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fa-taste-of-functional-java%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/power-of-akka-streams/" class="pagination--pager" title="The Power of Akka Streams
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/power-of-akka-streams/" rel="permalink">The Power of Akka Streams
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  14 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, Akka, JVM, Akka Streams
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/akka-actors-2/" rel="permalink">Data processing with Akka Actors: Part II
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, Akka, JVM, Big Data
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/akka-actors-1/" rel="permalink">Data processing with Akka Actors: Part I
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Scala, Akka, JVM, Big Data
</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="https://github.com/aleksandarskrbic"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Aleksandar Skrbic. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="http://localhost:4000/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>










  </body>
</html>